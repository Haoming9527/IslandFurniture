<script src="../checkCountry.js"></script>
<html>
<script src="../../header.js"></script>

<body>
    <div class="body">
        <script src="menu2.js"></script>
        <div role="main" class="main">
            <section class="page-top">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <h2>Promotions</h2>
                        </div>
                    </div>
                </div>
            </section>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h2>Current <strong>Deals</strong></h2>
                        <p class="lead">Check out our latest offers!</p>
                    </div>
                </div>

                <hr class="tall" />

                <div class="row" id="promotionsContainer">
                    <!-- Promotions will be loaded here -->
                </div>

            </div>
        </div>
        <script src="../footer.js"></script>
    </div>

    <script>
        fetch('/api/getPromotions')
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                var container = document.getElementById('promotionsContainer');
                if (data && data.length > 0) {
                    data.forEach(function (promo) {
                        var html = `
                            <div class="col-md-6">
                                <div class="featured-box featured-box-primary featured-box-effect-1" style="height: 100%; cursor: pointer;" onclick="window.location.href='furnitureProductDetails.html?sku=${promo.sku}'">
                                    <div class="box-content">
                                        <div style="position: relative;">
                                            <img src="${promo.imageURL}" class="img-responsive" style="width: 100%; height: 200px !important; max-height: 200px !important; object-fit: cover; margin-bottom: 15px;" alt="${promo.title}">
                                            <div style="position: absolute; top: 10px; right: 10px; background-color: #d2322d; color: white; padding: 5px 10px; font-weight: bold; border-radius: 3px;">
                                                ${promo.discountRate}% OFF
                                            </div>
                                        </div>
                                        <h4 class="text-uppercase">${promo.title}</h4>
                                        <p>${promo.description}</p>
                                        <p class="text-primary" style="font-weight: bold;">
                                            Valid: ${new Date(promo.startDate).toLocaleDateString()} - ${new Date(promo.endDate).toLocaleDateString()}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.innerHTML += html;
                    });
                } else {
                    container.innerHTML = '<div class="col-md-12"><p>No active promotions at the moment.</p></div>';
                }
            })
            .catch(function (error) {
                console.error('Error fetching promotions:', error);
                document.getElementById('promotionsContainer').innerHTML = '<div class="col-md-12"><p>Error loading promotions.</p></div>';
            });

        // Minor Promotions
        var countryId = localStorage.getItem("countryId");
        if (countryId) {
            fetch('/api/getMinorPromotions?countryId=' + countryId)
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    var container = document.createElement('div');
                    container.className = "row";
                    container.innerHTML = '<div class="col-md-12"><h3>Other <strong>Promotions</strong></h3></div>';

                    if (data && data.length > 0) {
                        data.forEach(function (promo) {
                            var cardHtml = `
                                <div class="col-md-4 col-sm-6">
                                    <div class="featured-box featured-box-secundary featured-box-effect-1" style="margin-bottom: 20px;">
                                        <div class="box-content" style="padding: 20px; text-align: left;">
                                            <h4 class="text-uppercase" style="margin-bottom: 5px; color: #d2322d;">${promo.discountRate}% OFF</h4>
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background: #f5f5f5; padding: 5px 10px; border-radius: 4px;">
                                                <strong style="font-size: 1.2em; letter-spacing: 1px;">${promo.promoCode}</strong>
                                                <button class="btn btn-xs btn-primary" onclick="copyToClipboard('${promo.promoCode}')" title="Copy Code">
                                                    <i class="fa fa-copy"></i> Copy
                                                </button>
                                            </div>
                                            <p style="font-size: 0.9em; margin-bottom: 5px;">${promo.description}</p>
                                            <p class="text-muted" style="font-size: 0.8em; margin-bottom: 0;">
                                                Valid until: ${new Date(promo.endDate).toLocaleDateString()}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            container.innerHTML += cardHtml;
                        });

                        // Append after the main promotions container
                        document.getElementById('promotionsContainer').parentNode.appendChild(container);
                    }
                })
                .catch(function (error) {
                    console.error('Error fetching minor promotions:', error);
                });
        }

        function copyToClipboard(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;

            // Avoid scrolling to bottom
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                var successful = document.execCommand('copy');
                var msg = successful ? 'successful' : 'unsuccessful';
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }

            document.body.removeChild(textArea);
            alert('Code ' + text + ' copied to clipboard!');
        }
    </script>
</body>

</html>